C51 COMPILER V9.00   MAIN                                                                  11/27/2013 01:18:06 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\out\main.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE ..\user\main.c BROWSE DEBUG OBJECTEXTEND PRINT(..\listing\main.lst) OBJECT(
                    -..\out\main.obj)

line level    source

   1          /**********************TS-51A单片机开发板例程************************
   2          *               Copyright (c) 2013,52探索 单片机开发板
   3          *               All rights reserved
   4          *       
   5          *               文件名称：led.c
   6          *               功能描述：本程序驱动12864显示一副图片
   7          * 
   8          *               当前版本：1.0
   9          *               作    者：52探索
  10          *       完成日期：2013-5-29
  11          *
  12          *               取代版本：无
  13          *       改进内容：无
  14          *
  15          *               使用环境：TS-51A开发板 + STC89C52 + 11.0592M晶振 + Keil C51 V9.0 
  16          *       
  17          *               淘宝地址：http://shop104208028.taobao.com/
  18          *               QQ      : 10903659
  19          *               QQ群    ：336397723  336398729   336398900
  20          ******************************************************************/
  21          #include <reg51.h>
  22          #include <intrins.h>
  23          
  24          #define uchar unsigned char
  25          #define uint  unsigned int
  26          #define LCD_data  P0             //数据口
  27          #define delayNOP(); {_nop_();_nop_();_nop_();_nop_();};
  28          
  29          sbit LCD_RS  =  P1^3;            //寄存器选择输入 
  30          sbit LCD_RW  =  P1^4;            //液晶读/写控制
  31          sbit LCD_EN  =  P1^5;            //液晶使能控制
  32          sbit LCD_PSB =  P1^0;            //串/并方式控制
  33          sbit wx      =  P2^7;
  34          sbit dx      =  P2^6;
  35          
  36          unsigned char code zhu[]=               //图片代码
  37          {
  38          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  39          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  40          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  41          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xD4,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  42          0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  43          0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  44          0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  45          0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  46          0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  47          0x00,0x00,0x03,0x50,0x00,0x50,0x80,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  48          0x00,0x00,0x3C,0x04,0x00,0xA0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  49          0x00,0x00,0x40,0x01,0x0B,0x15,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  50          0x00,0x00,0x40,0x00,0x88,0x00,0x00,0x06,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  51          0x00,0x01,0x80,0x00,0x60,0x00,0x00,0x05,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  52          0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x03,0x90,0x00,0x01,0xB6,0x36,0x00,0x00,0x00,
  53          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x40,0x00,0x01,0xFE,0x36,0x00,0x00,0x00,
  54          0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x02,0x20,0x00,0x01,0xB6,0x36,0x00,0x00,0x00,
C51 COMPILER V9.00   MAIN                                                                  11/27/2013 01:18:06 PAGE 2   

  55          0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x02,0xA0,0x00,0x03,0x6F,0xFF,0x00,0x00,0x00,
  56          0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x1D,0x00,0x00,0x00,0x00,0x2C,0x00,0x00,0x00,
  57          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xC0,0x00,0x00,0x00,0x28,0x00,0x00,0x00,
  58          0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,
  59          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A,0x80,0x40,0x00,0x00,0x00,0x00,0x00,0x00,
  60          0x00,0x00,0x10,0x80,0x00,0x00,0x1F,0x08,0x47,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,
  61          0x00,0x00,0x01,0x20,0x00,0x00,0x3D,0x13,0x0C,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,
  62          0x00,0x00,0x08,0x10,0x00,0x00,0x27,0xA0,0x18,0x06,0x00,0x00,0x00,0x00,0x00,0x00,
  63          0x00,0x00,0x02,0x10,0x00,0x00,0x3F,0x80,0x38,0xC7,0x00,0x00,0x00,0x00,0x00,0x00,
  64          0x00,0x00,0x04,0x03,0xE0,0x00,0x33,0x90,0x3F,0xC7,0x00,0x00,0x00,0x00,0x00,0x00,
  65          0x00,0x00,0x00,0x03,0xB0,0x00,0x33,0x10,0x7F,0x87,0x00,0x00,0x00,0x00,0x00,0x00,
  66          0x00,0x00,0x08,0x24,0xF0,0x0C,0x0E,0x00,0xFF,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,
  67          0x00,0x00,0x00,0x07,0xF0,0xC2,0x00,0x00,0xFE,0x1F,0x81,0xB3,0xE6,0xD8,0xF0,0x00,
  68          0x00,0x00,0x08,0x46,0x71,0x06,0x00,0x08,0x3F,0x1F,0x01,0xF6,0x67,0xF9,0xB0,0x00,
  69          0x00,0x00,0x00,0x03,0x20,0x98,0x00,0x00,0x3F,0xFF,0x01,0xB6,0xC6,0xD9,0x80,0x00,
  70          0x00,0x00,0x08,0x40,0xC0,0x24,0x00,0x04,0x3F,0x1F,0x03,0x7F,0xFD,0xBE,0xFC,0x00,
  71          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x1E,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,
  72          0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x01,0x0E,0x1C,0x00,0x00,0x00,0x00,0x00,0x00,
  73          0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x87,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,
  74          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  75          0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  76          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  77          0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  78          0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  79          0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,
  80          0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x02,0x08,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,
  81          0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,
  82          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x88,0x00,0x01,0x8C,0x00,0x00,0x00,0x00,
  83          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x01,0x8E,0x00,0x00,0x00,0x00,
  84          0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0xB6,0x06,0xDB,0x6C,0x00,
  85          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xFF,0x06,0xDB,0x6C,0x00,
  86          0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  87          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  88          0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  89          0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  90          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  91          0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  92          0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  93          0x00,0x00,0x00,0x00,0x40,0x00,0x01,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  94          0x00,0x00,0x00,0x00,0x94,0xA4,0x68,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  95          0x00,0x00,0x00,0x00,0x02,0x19,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  96          0x00,0x00,0x00,0x00,0x42,0x00,0x10,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  97          0x00,0x00,0x00,0x00,0x20,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  98          0x00,0x00,0x00,0x00,0x14,0x00,0x0A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  99          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 100          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 101          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
 102          };
 103          
 104          /*
 105          * 功  能：11.0592M 下 延时1毫秒
 106          * 参  数：要延时的毫秒数
 107          * 返回值：无
 108          */
 109          void delay(unsigned  int ms)
 110          {
 111   1              while(ms--)
 112   1              {
 113   2                      unsigned  char i;
 114   2                      for(i=0; i<250; i++)  
 115   2                      {
 116   3                              _nop_();                           
C51 COMPILER V9.00   MAIN                                                                  11/27/2013 01:18:06 PAGE 3   

 117   3                              _nop_();
 118   3                              _nop_();
 119   3                              _nop_();
 120   3                      }
 121   2              }
 122   1      }               
 123          
 124          
 125          /*
 126          * 功  能：检查LCD12864是否忙
 127          * 参  数：无
 128          * 返回值：返回1：LCD出于忙状态
 129          */
 130          bit lcd_busy()
 131          {                          
 132   1              bit result;
 133   1      
 134   1              LCD_RS = 0;
 135   1              LCD_RW = 1;
 136   1              LCD_EN = 1;
 137   1              delayNOP();
 138   1              result = (bit)(P0&0x80);
 139   1              LCD_EN = 0;
 140   1      
 141   1              return(result); 
 142   1      }
 143          
 144          /*
 145          * 功  能：写指令到LCD
 146          * 参  数：要写入的指令
 147          * 返回值：无
 148          */
 149          void lcd_wcmd(uchar cmd)
 150          {                          
 151   1              while(lcd_busy());
 152   1      
 153   1              LCD_RS = 0;
 154   1              LCD_RW = 0;
 155   1              LCD_EN = 0;
 156   1              _nop_();
 157   1              _nop_(); 
 158   1              P0 = cmd;
 159   1              delayNOP();
 160   1              LCD_EN = 1;
 161   1              delayNOP();
 162   1              LCD_EN = 0;  
 163   1      }
 164          
 165          /*
 166          * 功  能：LCD写数据
 167          * 参  数：要写入的数据
 168          * 返回值：无
 169          */
 170          void lcd_wdat(uchar dat)
 171          {                          
 172   1              while(lcd_busy());
 173   1      
 174   1              LCD_RS = 1;
 175   1              LCD_RW = 0;
 176   1              LCD_EN = 0;
 177   1              P0 = dat;
 178   1              delayNOP();
C51 COMPILER V9.00   MAIN                                                                  11/27/2013 01:18:06 PAGE 4   

 179   1              LCD_EN = 1;
 180   1              delayNOP();
 181   1              LCD_EN = 0; 
 182   1      }
 183          
 184          /*
 185          * 功  能：LCD初始化
 186          * 参  数：无
 187          * 返回值：无
 188          */
 189          void lcd_init(void)
 190          { 
 191   1      
 192   1              LCD_PSB = 1;         //并口方式
 193   1              
 194   1              lcd_wcmd(0x34);      //扩充指令操作
 195   1              delay(5);
 196   1              lcd_wcmd(0x30);      //基本指令操作
 197   1              delay(5);
 198   1              lcd_wcmd(0x0C);      //显示开，关光标
 199   1              delay(5);
 200   1              lcd_wcmd(0x01);      //清除LCD的显示内容
 201   1              delay(5);
 202   1      }
 203          
 204          /*
 205          * 功  能：在整个液晶屏幕上画图
 206          * 参  数：图片的点阵数据
 207          * 返回值：无
 208          */
 209          void Draw_PM(const unsigned  char *ptr)
 210          {
 211   1              uchar i, j, k;
 212   1              
 213   1              wx = 0;
 214   1              dx = 0; 
 215   1              lcd_wcmd(0x34);        //打开扩展指令集
 216   1              i = 0x80;
 217   1                          
 218   1              for(j=0; j<32; j++)
 219   1              {
 220   2                      lcd_wcmd(i++);
 221   2                      lcd_wcmd(0x80);
 222   2                      for(k=0; k<16; k++)
 223   2                      {
 224   3                              lcd_wdat(*ptr++);
 225   3                      }
 226   2              }
 227   1              i = 0x80;
 228   1              for(j=0; j<32; j++)
 229   1              {
 230   2                      lcd_wcmd(i++);
 231   2                      lcd_wcmd(0x88);    
 232   2                      for(k=0; k<16; k++)
 233   2                      {
 234   3                              lcd_wdat(*ptr++);
 235   3                      } 
 236   2              }  
 237   1              lcd_wcmd(0x36);        //打开绘图显示
 238   1              lcd_wcmd(0x30);        //回到基本指令集
 239   1      }
 240          
C51 COMPILER V9.00   MAIN                                                                  11/27/2013 01:18:06 PAGE 5   

 241          void main(void)
 242          {
 243   1              wx = 0;
 244   1              dx = 0; 
 245   1              lcd_init();                //初始化LCD    
 246   1              Draw_PM(zhu);                       //显示可爱猪的图片
 247   1              while(1);       
 248   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    274    ----
   CONSTANT SIZE    =   1024    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
